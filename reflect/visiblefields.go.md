# File: visiblefields.go

visiblefields.go文件是Go语言的反射包(reflect)中的一个文件，主要是实现了结构体的可视字段获取功能，即在反射过程中获取结构体中公开（可导出）的字段。

在Go语言中，一个结构体类型可以有不同的字段，但是有些字段并不会被导出，不能被外部访问或使用，这些称之为私有字段。为了使用反射正确地操作结构体，我们需要获取到结构体中所有的公开字段，而这就是visiblefields.go文件的作用。

该文件实现了一个可视字段提取器，其核心函数是getExportedFields()方法，该方法可以逐层地遍历一个结构体类型的每一个字段，并返回所有可导出的字段。

在该可视字段提取器中，包括以下步骤：

1.遍历结构体中的每一个字段，使用reflect.Type的NumField()方法和Field()方法实现。

2.判断每个字段是否可以被导出，通过reflect.StructField的可导出标志(field.Flags&flagExport != 0)实现。

3.对于每个可导出的字段，逐步处理，将字段名和字段类型都存储在封装结构体VisibleField中。

可视字段提取器可以帮助我们在使用反射包进行结构体操作时，只操作可导出的字段，从而使代码更加健壮、不易出错。




---

### Structs:

### visibleFieldsWalker

visibleFieldsWalker是一个用于遍历Go语言的结构体类型中可见的字段的结构体。它的主要作用是在反射过程中，根据指定的条件来获取结构体类型的可见字段，并将这些字段存储在一个数组中。

visibleFieldsWalker结构体中包含以下字段：

- values：这个字段是一个空接口切片，用于存储可见的字段的值。
- numFields：这个字段是一个整数，表示可见的字段的数量。
- fieldTypeCache：这个字段是一个指向字段类型缓存map的指针，用于缓存已经遍历过的字段类型。

visibleFieldsWalker结构体中包含以下方法：

- walk：这个方法是递归遍历结构体类型的方法，它接受一个反射值对象、一个深度值和一个结构体类型信息，用于遍历结构体类型的字段，将可见的字段的值存储在values数组中，并返回可见字段的数量。

- visibleFields：这个方法是一个公共方法，它接受一个反射类型对象、一个bit字段和一个字段过滤函数。它调用walk方法遍历结构体类型，并返回可见的字段的数量和值。

在Go语言中，结构体类型的字段的可见性受到字段的标识符的可见性的限制。visibleFieldsWalker结构体通过反射和递归遍历，实现了获取结构体类型中可见字段的值，并且可以根据指定的过滤条件来获取符合条件的可见字段。



## Functions:

### VisibleFields

VisibleFields函数的作用是获取结构体中可见的字段。在Go语言中，结构体的字段分为可导出和不可导出两种，即首字母大写的字段为可导出字段，而小写字母开头的字段为不可导出的字段。VisibleFields函数会过滤掉不可导出的字段，只返回可导出字段。

该函数的参数是一个reflect.Type类型的参数，表示要获取可见字段的结构体类型。函数的返回值是一个切片，其中每个元素都是reflect.StructField类型的变量，表示一个可见的结构体字段。每个StructField都包含了该字段的名称、类型、是否为匿名字段、是否为可导出字段等信息。

VisibleFields函数是reflect包中较为简单的一个函数，但它可以在某些情况下非常有用，如通过反射来动态获取结构体中可见的字段，并根据字段信息进行操作或者赋值。



### walk

walk函数是一个递归函数，用于遍历结构体类型中的所有可导出字段，并将这些字段保存在一个切片中。

具体来说，walk函数接收一个Value类型的参数v，代表一个结构体类型的实例，以及一个切片fields，用于保存所有可导出字段的信息。walk函数首先判断v是否为结构体类型，如果是，则遍历其所有字段。对于每个字段，判断其是否可导出，如果是，则将其保存在fields中，并递归调用walk函数，以便遍历其内部的嵌套结构体类型。

walk函数最终返回fields，即保存了所有可导出字段信息的切片。这个切片中的每个元素都是一个StructField类型，包含了该字段的名称、类型、标签等信息，可以通过反射机制进一步操作和访问这些字段。

总之，walk函数的作用是通过递归遍历结构体类型中的所有可导出字段，并将这些字段信息保存在一个切片中，以便后续对结构体类型的操作。



