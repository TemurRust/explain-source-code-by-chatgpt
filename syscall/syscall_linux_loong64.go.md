# File: syscall_linux_loong64.go

syscall_linux_loong64.go是Go语言标准库中syscall包的一个文件，它定义了在Loong64平台下运行的Linux系统上的系统调用接口。

Loong64是一种64位指令集架构，是由中国的龙芯公司开发的处理器架构。该架构主要用于嵌入式和高性能计算领域。

在syscall_linux_loong64.go文件中，定义了Loong64平台下所支持的系统调用接口，这些接口包括文件操作、进程管理、网络通信、信号处理等等。通过这些接口，Go程序可以访问Linux系统底层的资源，实现各种功能和操作。




---

### Structs:

### sigset_t

在syscall_linux_loong64.go文件中，sigset_t是一个用于表示信号集的结构体。它由64位整数数组和一个长度字段组成。sigset_t结构体主要用于处理进程的信号掩码和阻塞信号。

进程可以使用sigprocmask系统调用设置信号掩码，以阻止或允许某些信号被接收。sigset_t结构体用于表示信号掩码，其中每个信号按位表示为1或0，1表示信号被屏蔽，0表示信号未被屏蔽。当进程接收到一个被屏蔽的信号时，该信号将被暂时挂起，等到该信号被解除屏蔽后才会被处理。

除了信号掩码外，sigset_t结构体还用于表示需要等待的信号。当进程使用sigwait系统调用等待某些信号时，它需要指定要等待的信号集。此时，sigset_t结构体也用于表示需要等待的信号。

总之，sigset_t结构体用于表示进程的信号掩码和等待信号集，它是一个在处理信号和控制信号传递方面非常重要的结构体。



## Functions:

### makedev

函数 makedev 在 syscall_linux_loong64.go 文件中是用来将主设备号和次设备号组合成一个设备号的。在 Linux 中，每个设备都有一个设备号，设备号由主设备号和次设备号组成，主设备号通常表示设备的类型，次设备号通常表示特定的设备实例。makedev 函数接受一个主设备号和一个次设备号作为参数，并返回一个组合后的设备号。这样，上层程序就可以使用这个设备号来访问特定的设备实例了。这个函数通常用于与系统底层交互的程序，如设备驱动程序等。



### timespecFromStatxTimestamp

syscall_linux_loong64.go这个文件中的timespecFromStatxTimestamp函数用于将Linux系统中的statx系统调用返回的时间戳转换为Go语言中的timespec结构体。该函数的作用是将Linux系统中获取的文件或目录的最后访问时间、修改时间和创建时间等时间戳信息转换为Go语言中的time.Time类型，方便开发人员进行时间相关的操作。

在具体实现上，该函数首先将statx系统调用中返回的时间戳结构体转换为以纳秒为单位的整型数值，然后将其转换为timespec结构体类型，该结构体中包含秒和纳秒两个字段，表示时间戳的整数部分和小数部分。最后，将该结构体返回，供开发人员进行进一步处理和应用。

使用该函数可以方便地将Linux系统中的时间戳与Go语言中的时间类型相互转换，为开发人员提供更加灵活和高效的时间操作功能。



### fstatat

syscall_linux_loong64.go是Go语言在LoongArch架构上，实现系统调用（syscall）相关功能的文件。其中的fstatat是用于获取指定文件或目录状态信息的系统调用。

具体来说，fstatat的作用是在指定路径下获取指定文件或目录的状态信息，例如文件的访问时间、修改时间、大小和权限等信息。该系统调用与stat和fstat系统调用相似，但它可以使用相对或绝对路径并指定搜索选项。

fstatat函数有四个参数，分别为：

1. dirfd：指定目录文件描述符，表示在此目录中查找文件或目录。如果dirfd为AT_FDCWD，则在当前工作目录中查找。

2. path：字符串类型参数，表示要查找的文件或目录的路径。

3. statbuf：结构体指针类型参数，用于返回获取到的文件或目录状态信息。

4. flags：选项参数，可以是0或AT_SYMLINK_NOFOLLOW，表示是否跟随链接。

总之，fstatat系统调用可以方便地获取指定文件或目录的状态信息，并进行相关处理的操作。



### Fstatat

Fstatat是一个系统调用函数，用于获取一个给定路径的文件或者目录的状态信息。在linux_loong64.go文件中，Fstatat函数的功能是在指定的文件描述符（fd）和路径名（path）下获取文件信息和属性，这个函数也可以用来获取符号链接目标文件的信息。

Fstatat函数的参数包括fd，path，statbuf和flag：
- fd为要获取文件信息的文件描述符
- path为文件或目录的路径名
- statbuf为存储获取到的文件信息的结构体
- flag参数控制获取文件信息的行为，例如可以通过设置AT_SYMLINK_NOFOLLOW来获取符号链接目标文件的信息。

通过调用Fstatat函数，应用程序可以获取文件或目录的基本信息，如文件类型、所属用户和组、权限等，这些信息可以用来进行权限控制、访问控制和文件操作等。



### Fstat

Fstat是一个系统调用函数，可以获取文件的元数据（例如，文件的用户ID，组ID，权限，大小，时间戳及其它属性）。在syscall_linux_loong64.go文件中，这个函数用于Linux平台上的Loong64硬件架构。

当调用Fstat函数时，需要传入一个文件描述符作为参数，并将文件元数据写入一个指向stat结构体的指针所指向的内存区域。stat结构体中包含了文件元数据的详细信息，如文件类型、所有者用户ID、所有者组ID、文件大小、最近访问时间、最近修改时间等。

具体来说，Fstat函数的主要作用是：

1. 获取文件的元数据，包括文件类型、所有者用户ID、所有者组ID、文件大小、最近访问时间、最近修改时间等。

2. 方便进行文件系统管理，如检查文件是否存在、判断文件类型等。

3. 在程序中进行文件操作时，可以使用Fstat函数检查文件元数据，以确保程序的正确性和安全性。

总的来说，Fstat函数在文件系统操作、文件管理和文件操作等方面都有重要作用。



### Stat

Stat是一个系统调用，用于获取文件的元数据信息，例如文件大小、修改时间、文件类型等。在syscall_linux_loong64.go中，Stat函数是用于获取Linux Longson64架构下文件元数据信息的。

具体来说，Stat函数包含以下参数：

- path：文件路径；
- stat：指向一个存放文件元数据信息的结构体的指针，可以获取到文件的大小、创建时间、修改时间、权限等信息。

在实现过程中，Stat函数会先将path路径转换为Linux下的路径表示（例如将“\”转换为“/”），然后通过系统调用获取文件元数据信息。最后，将获取到的信息存放到传入的stat结构体中。

总的来说，Stat函数在处理文件时起到了关键作用，能够提供文件元数据信息，帮助开发者更好地了解和操作文件。



### Lchown

Lchown是Linux系统调用中的一个函数，可以用于更改文件或目录的所有者和组。它的作用是将指定的文件或目录的用户ID（UID）和组ID（GID）更改为指定的值。

在syscall_linux_loong64.go文件中，Lchown函数的实现方式是通过调用系统调用chown来完成的。该函数有3个参数：文件路径，新UID和新GID。它返回一个整数值表示操作是否成功。如果成功，则返回0，否则返回一个非0值。

Lchown的使用场景包括但不限于以下几个方面：

1. 修改文件或目录的所有者和组：在Linux中，每个文件或目录都有一个属主和属组。Lchown可以用于更改它们，例如修改一个文件的所有者为另外一个用户、或者将一个目录的属组更改为一个不同的组。

2. 更改权限：Lchown函数可以用于更改权限。更改UID、GID可以更改文件或目录的访问权限，使得只有拥有相应权限的用户才能访问它们。

3. 实现文件限制：Lchown可以用于实现类似于SUID、SGID的功能，让一个普通用户拥有超级用户的权限，或者让一个组拥有其他组的权限。这一功能在一些安全限制方面具有重要的作用。



### Lstat

Lstat是用于获取文件或符号链接状态信息的函数，它的作用是获取指定路径的文件或符号链接的元数据信息。

Lstat函数的语法如下：

```
func Lstat(path string, stat *Stat_t) (err error)
```

其中，path参数表示要获取元数据信息的文件或符号链接路径；stat参数用于存储元数据信息；err返回错误信息。Lstat函数返回的元数据信息包括文件类型、权限、所属用户、所属组、大小、创建时间、修改时间等等。

在syscall_linux_loong64.go文件中，Lstat函数的实现方式与其他平台的Lstat函数有所不同，因为龙芯64位处理器的系统调用号码和其他平台存在差异。因此，该文件中的Lstat函数是专门为龙芯64位处理器定制的系统调用封装函数。它调用了龙芯64位处理器的系统调用，以实现获取文件或符号链接状态信息的功能。



### Select

Select函数是一个底层的系统调用函数，用于在多个文件描述符中等待事件发生。该函数可以用于实现高级I/O复用功能，例如异步I/O、网络编程等。

在具体实现上，Select函数会接收一个指向文件描述符集合的指针，并阻塞等待其中任意一个文件描述符发生事件。文件描述符集合包含三种类型的文件描述符：读集合、写集合、异常集合。如果其中任意一个集合中的文件描述符发生了对应的事件，Select函数将返回就绪的文件描述符数量，并且可以使用类似于类Unix系统的I/O函数来进行读取或写入操作。

在syscall_linux_loong64.go文件中，Select函数的实现是针对Loongson 64位处理器的，适用于Linux系统。该实现基于Linux内核提供的epoll机制，提供了高效的I/O复用方式。



### setTimespec

setTimespec函数是Linux系统调用中的一个函数，用于将TimeSpec时间数据结构转换为指向64位龙芯处理器上的内存地址的指针。

该函数的具体作用是将传入的TimeSpec结构中的秒数和纳秒数分别转换为64位的整数类型，并将这两个整数存储到指向Loong64处理器上的内存地址的指针中。这个指针可以用作Linux系统调用中某些需要时间参数的函数的参数。

具体而言，setTimespec函数的参数是一个指向TimeSpec数据结构的指针和一个指向int64类型的指针。TimeSpec结构包含两个成员变量：tv_sec和tv_nsec，分别表示秒数和纳秒数。setTimespec函数将这两个成员变量转换为64位的整数类型，并分别存储到指向Loong64处理器上的内存地址的指针中。

这个函数主要用于内核模块的开发和操作系统底层的调试，一般情况下普通用户并不需要使用它。



### setTimeval

setTimeval函数是在syscall_linux_loong64.go文件中定义的一个函数。该函数的主要作用是将秒和微秒组成的时间，转换为一个timeval结构体。

timeval结构体在系统编程中通常用作表示时间间隔的结构体，其中tv_sec表示秒数，tv_usec表示微秒数。

setTimeval函数的具体实现就是将传入的秒数和微秒数赋值给timeval结构体的tv_sec和tv_usec字段。

该函数主要被用于网络编程中，特别是在使用syscall库进行TCP/UDP通信时，需要使用timeval结构体来设置网络操作的超时时间。



### futimesat

futimesat是一个系统调用函数，用于修改指定文件的访问时间和修改时间，具体作用如下：

1. 修改文件的访问时间和修改时间
通过调用futimesat函数，可以修改指定文件的访问时间和修改时间。该函数需要传入一个文件描述符fd和一个timespec数组，数组中存放了新的访问时间和修改时间。调用成功后，文件的访问时间和修改时间将被修改为timespec数组中指定的时间。

2. 执行对时间的处理
该函数处理的时间是基于Epoch（1970年1月1日 00:00:00 UTC）开始经过的秒数，以及纳秒数。因此，通过传入合适的参数，可以实现添加或减少文件的访问时间和修改时间。

3. 支持使用相对时间
futimesat函数还支持使用相对时间，可以通过设置timespec数组中的tv_sec和tv_nsec来指定相对于当前时间的偏移量。例如，将tv_sec设置为10，tv_nsec设置为0，则访问时间和修改时间将被设置为当前时间往后推10秒的时间。

总之，futimesat函数提供了一种方便的方式来修改文件的访问时间和修改时间，同时支持使用相对时间，可以满足一些特殊需求。



### Time

在go/src/syscall中syscall_linux_loong64.go文件中，有一个名为Time的func。它的作用是用于获取系统时间并将其转换为一个time.Time类型的值。

具体来说，Time函数会调用系统调用clock_gettime来获取当前的系统时间，然后将其转换成一个time.Time类型的值。这个time.Time类型的值包含了当前时间的年份、月份、日期、时间、时区等信息。

需要注意的是，Time函数只能在Loong64（龙芯64）架构上运行，其他架构上的syscall_linux_xx.go文件中的Time函数实现方式可能会有所不同。同时，因为获取系统时间的系统调用可能会受到各种因素的影响，包括但不限于 CPU 核心数量和负载、时钟频率、操作系统版本、硬件设置等，因此也需要谨慎使用。



### Utime

syscall_linux_loong64.go这个文件实现了Linux LoongArch 64位体系结构上的系统调用接口。其中的Utime函数用于修改文件或目录的访问时间和修改时间。

具体来说，Utime函数接受两个参数，第一个参数是文件路径名，第二个参数是一个指向Timeval结构体的指针。Timeval结构体定义了访问时间和修改时间，以秒和微秒为单位。当第二个参数为nil时，访问时间和修改时间将被设置为当前时间。

Utime函数的作用类似于Unix系统中的utime函数，用于修改文件或目录的访问和修改时间，主要用于管理文件系统和日志管理等方面。



### utimes

utimes函数用于修改文件的访问和修改时间。该函数接受3个参数，第一个参数是要修改时间的文件名，第二个参数是指向访问时间和修改时间的数组，第三个参数是指定数组中的时间单位，单位可以是秒或纳秒。

在syscall_linux_loong64.go文件中，该函数被用于实现Linux系统上的utimes系统调用。该函数会将参数转换成LoongArch64架构下的系统调用参数，并通过svc指令执行系统调用。

在LoongArch64架构上，utimes系统调用的编号为313，该调用只能修改当前进程有写权限的文件的时间戳。如果成功，该系统调用将返回0，否则返回-1并设置errno变量表示错误类型。



### Getrlimit

Getrlimit是一个系统调用函数，用于获取指定进程的资源限制。在syscall_linux_loong64.go文件中，实现了在LoongArch 64位操作系统上调用Getrlimit时的行为。

具体来说，Getrlimit函数可以获取指定进程可以使用的资源的上限和下限。这些资源包括CPU时间、内存、文件描述符等等。Getrlimit可以通过设置rlimit结构体的字段来改变限制，并可以通过RLIMIT_INFINITY来取消限制。在实现Getrlimit函数时，需要调用syscall.Syscall6系统调用函数进行实际的系统调用，并根据返回值判断是否出错。

在LoongArch 64位操作系统上实现Getrlimit的主要目的是为了支持LoongArch 64位平台下的应用程序开发。通过该函数，应用程序可以了解系统对其使用内存、CPU等资源的限制，并可以根据需要进行调整，以避免资源不足的情况。



### setrlimit

setrlimit这个func用于设置进程资源限制。资源限制就是限制一个进程所能消耗的系统资源，例如CPU时间、内存、文件大小等。在Linux中，有一些资源是可以被限制的，使用setrlimit可以设置这些限制。

这个func接收两个参数，第一个参数是限制的类型（例如文件大小、CPU时间等），第二个参数则是一个结构体，用于指定限制的值。具体来说，结构体中包含了以下几个字段：

- RLIM_INFINITY：用于指示无限制。
- RLIM_SAVED_MAX：用于指示一个软限制的最大值，在这个最大值内，进程可以自由修改，并且可以恢复到这个值。
- RLIM_SAVED_CUR：用于指示当前的软限制。

通过设置这些字段的值，可以指定进程对相应资源的限制。在调用setrlimit之前，可以使用getrlimit来查询当前资源的限制。对于当前进程而言，我们可以使用如下代码查询当前进程的常见资源限制：

```
var rLimit syscall.Rlimit
syscall.Getrlimit(syscall.RLIMIT_CPU, &rLimit)
fmt.Println(rLimit)
```

返回的第一个数字表示软限制，第二个数字表示硬限制。软限制是当前资源的限制值，硬限制则是管理员可以“硬性”设置的限制值，超过了硬限制就无法修改了。可以使用setrlimit来修改软限制。

例如，以下代码将当前进程的文件大小限制设置为100MB：

```
var rl syscall.Rlimit
rl.Cur = 104857600 // 100MB
rl.Max = 104857600 // 100MB
syscall.Setrlimit(syscall.RLIMIT_FSIZE, &rl)
```



### rawSetrlimit

rawSetrlimit函数是Linux-LoongArch平台上实现的一个底层系统调用，用于设置进程资源限制。该函数将指定的资源软限制和硬限制设置到进程中，并返回设置结果。

具体实现中，rawSetrlimit函数接受两个参数：资源类型参数和限制结构体指针参数。资源类型参数是一个整数值，表示需要设置的资源类型，例如CPU时间、内存使用量、文件大小等等。限制结构体指针参数是一个指向包含资源限制值的结构体的指针，它包含两个值：软限制和硬限制。

rawSetrlimit函数的实现过程中，它首先将传递的参数打包成一个系统调用参数结构体，然后使用系统调用的方式将参数传递给内核。内核将参数解析后，将软限制和硬限制设置到调用进程的资源限制中，并返回成功或失败的结果。

需要注意的是，rawSetrlimit函数是一个低级别的系统调用函数，其参数和返回值并不适合直接在应用程序层面使用。在实际应用中，开发者一般会使用更高级别的系统调用函数（如setrlimit）来调用rawSetrlimit函数并进行资源限制设置。



### GetEra

GetEra函数是用于获取基准年代的系统调用。它返回一个int值，表示距离基准年代的年数。

这个函数的作用是在计算机系统中，可能需要使用某一个基准年代来作为时间的起点，比如UNIX时间戳使用1970年1月1日来作为基准年代。因此，GetEra函数可以让开发者在需要的时候获取系统所使用的基准年代，方便进行时间计算和数据处理。

在linux_loong64.go文件中，GetEra函数的具体实现是通过读取/proc/sys/kernel/tainted文件来获取系统的状态信息，并将其中的taint_flags字段进行解析，计算出taint_year并返回。这个taint_year就是系统的基准年数。

总的来说，GetEra函数是系统时间处理中的一部分，它提供了一种获取系统基准年代的方式，方便开发者进行相关计算和处理。



### SetEra

SetEra函数主要是用于兼容性的目的，在 LOONGARCH 64 体系结构中设置单独的系统调用号，在这种情况下，每个系统调用都有一个附加的era参数，这个参数是一个整数值，用于识别系统的版本和 API。

SetEra函数的作用是设置此参数，该参数将被传递给系统调用。如果没有设置此参数，则默认为0。

SetEra函数的定义如下：

```go
func SetEra(era int) error {
    return ENOSYS
}
```

可以看到，实际上这个函数不做任何事情，只是返回了一个ENOSYS错误，表示此系统调用不可用。因此，在LOONGARCH 64系统上，应该使用系统提供的不同的方式来设置era参数。



### SetLen

在syscall_linux_loong64.go文件中，SetLen函数用于设置文件大小，它的作用是将文件修改为指定的大小。

具体来说，SetLen函数通过调用lseek系统调用来移动文件指针到文件末尾，然后再通过调用ftruncate系统调用来修改文件大小。

在文件系统中，文件大小通常是按字节数计算的。当文件被打开或创建时，文件大小为0。随着向文件写入数据，文件大小会逐渐增加。如果需要缩小文件大小，则需要使用SetLen函数来修改文件大小。如果需要增加文件大小，则可以直接向文件写入数据以增加文件大小。

总之，SetLen函数是一个用于设置文件大小的系统调用函数，它可以根据需要修改文件大小，以满足应用程序的需求。



### SetControllen

func SetControllen(fd int, length int) error

SetControllen函数是syscall_linux_loong64.go文件中的一个函数，用于设置控制终端。它的作用是将指定文件描述符fd所对应的进程的控制终端设置为长度为length的伪终端。这个函数通常用于创建一个新的伪终端，并将其分配给子进程作为控制终端，以便控制子进程的输入和输出。该函数返回值为错误类型，如果设置失败则返回相应的错误信息。

对于Linux系统来说，伪终端是一种特殊的设备文件，它模拟了一个真实的终端设备，用户可以通过它进行输入和输出，它也可以作为进程的控制终端。通过使用伪终端，程序可以从一个进程中把一些输出内容转发给另一个进程，同时也可以将从键盘或其他输入设备上得到的输入内容通过伪终端传递给进程。

在Unix和Linux系统中，每个进程都有一个控制终端，如果该进程是通过shell程序启动的，那么它的控制终端就是由shell程序分配的。控制终端通常用于接收输入和输出信息，当输入或输出出现问题时，也可以接收原因和错误信息。通过设置控制终端，程序可以方便地控制子进程的输入和输出，从而更好地管理进程。



### InotifyInit

InotifyInit函数是用来初始化inotify实例的函数。inotify是Linux系统中的一个文件系统监控机制，可以用来监控文件系统的变化。

具体来说，inotify可以监控一个或多个文件或目录，当这些文件或目录中的任何一个被修改、创建、删除或移动时，系统会发送一个通知给监控程序。

在syscall_linux_loong64.go这个文件中，InotifyInit函数调用系统调用syscall.Syscall6来实现。该函数接受两个参数：一个整数flags和一个无符号整数size。flags参数指定inotify实例的属性，可以是IN_NONBLOCK（非阻塞模式）或IN_CLOEXEC（进程退出时自动关闭inotify实例）。size参数指定实例中的事件缓冲区大小，即在等待事件时可以缓存多少个事件。

InotifyInit函数返回两个值：一个整数fd和一个错误。fd是inotify实例的文件描述符，可以用于读取系统发送的通知事件。如果发生错误，则返回非零错误值。如果返回值小于0，则表示初始化失败。

总之，InotifyInit函数的作用是初始化inotify实例，使其能够监控文件系统的变化。



### Pause

在syscall_linux_loong64.go文件中，Pause这个func的作用是暂停当前的进程，直到接收到一个信号为止。

这个函数使用了Linux系统调用sigpause来实现。sigpause函数会设置信号掩码，将所有指定的信号阻塞，并且等待其中任意一个信号的到来。一旦接收到信号，该函数会解除信号阻塞并返回。因此，Pause函数也会设置信号掩码并等待信号到来，直到它接收到信号后返回。

这个函数的返回值始终为-1，并且在发生错误时会设置errno。调用这个函数的主要目的是防止进程在繁忙等待信号的过程中浪费CPU资源。



