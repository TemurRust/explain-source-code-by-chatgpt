# File: grpc-go/authz/grpc_authz_server_interceptors.go

grpc_authz_server_interceptors.go文件是用于在gRPC服务器端添加授权拦截器的文件。授权拦截器的作用是在服务器端处理每个进入的RPC请求之前进行授权验证。

该文件中的"logger"变量用于记录授权拦截器的日志信息。日志对于排查问题和跟踪系统行为非常有用。

"StaticInterceptor"结构体是一个静态拦截器，它根据配置的权限列表对请求进行授权验证。它通过检查传入请求的方法和元数据中的信息来验证用户的身份和权限。如果认证失败，则返回一个gRPC状态错误。

"FileWatcherInterceptor"结构体是一个文件监视器拦截器。它监视配置文件的更改并重新加载权限列表，以便动态地更新授权策略。使用文件监视器拦截器可以实现运行时动态更改权限规则而无需重新启动服务器。

"NewStatic"函数用于创建一个静态拦截器。它通过给定的权限列表和日志记录器创建并初始化StaticInterceptor结构体。

"UnaryInterceptor"和"StreamInterceptor"函数是生成gRPC服务器端的拦截链函数，用于拦截每个进入的RPC请求并进行授权验证。它们将具体的拦截器逻辑与gRPC服务器绑定在一起。

"NewFileWatcher"函数用于创建一个文件监视器拦截器。它通过给定的配置文件路径和日志记录器创建并初始化FileWatcherInterceptor结构体。

"run"函数是一个私有函数，用于启动文件监视器线程，监视配置文件的更改并在需要时重新加载授权策略。

"updateInternalInterceptor"函数是一个私有函数，用于更新拦截器的内部状态。它根据新的权限列表重新初始化静态拦截器或重新加载文件监视器拦截器。

"Close"函数用于关闭文件监视器和释放相关资源。

总而言之，该文件提供了一组用于在gRPC服务器端添加授权拦截器的功能和组件，以便进行身份验证和权限验证，并提供了静态和动态两种类型的拦截器来满足不同的需求。

