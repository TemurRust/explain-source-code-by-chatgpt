# File: embed.go

embed.go是Go语言自1.16版本中新增的一个标准库，它的主要作用是提供一种内置的机制，让开发者可以将文件、目录和其他资源嵌入到Go程序中。这个机制被称为“嵌入式文件系统”，类似于C语言中的“静态链接库”。

嵌入式文件系统有多种用途，其中一个常见的应用场景是在开发Web应用程序时，将相关的HTML、CSS、JavaScript等文件嵌入到Go程序中，从而避免在部署时需要依赖外部文件，提高发布的灵活性和可靠性。

embed.go文件中包含一个名为“embed”的结构体，它的内部包含了一些基本的方法和属性，用于管理嵌入式文件系统。其中比较常用的方法有以下几个：

1. 空函数FS() embed.FS：用于获取默认的嵌入式文件系统对象，该对象代表了整个程序的嵌入式资源。

2. 空函数FS() embed.FS：用于获取指定的嵌入式文件系统对象，该对象代表了指定目录下的所有嵌入式资源。

3. fs.ReadFile(embed.FS, "path/to/file")：读取指定路径下的嵌入式文件，返回一个[]byte类型的切片，可以用于后续文件的读取、解析等操作。

4. fs.ReadDir(embed.FS, "path/to/dir")：读取指定路径下的嵌入式目录，返回一个[]os.FileInfo类型的切片，可以用于获取目录中的文件名、文件大小、创建时间等信息。

除了上述常用方法之外，还有一些额外的方法和选项，可以用于更加灵活地操作嵌入式文件系统。总的来说，embed.go文件为开发者提供了一种新的机制，方便地将文件、目录和其他资源嵌入到Go程序中，增强了程序的灵活性和可维护性。

## Functions:

### embedFileList

embedFileList函数的作用是将嵌入式文件列表转换为一个slice，该slice包含了所有嵌入式文件的信息，比如文件名、大小、数据等。

具体来说，embedFileList函数通过遍历嵌入式文件列表的数据结构，逐个构建文件信息对象，然后将这些对象存储在一个slice中，最后返回这个slice。文件信息对象包含了以下字段：

- name：文件名
- data：文件数据
- siz：文件大小
- typ：文件类型（一般是"file"）

在embedFileList函数中，还定义了另外两个私有函数：

- isDir：判断一个嵌入式文件是否是目录
- trimPath：去除一个嵌入式文件路径前的"/"字符，方便后续处理

isDir函数通过判断嵌入式文件名的结尾是否是"/"，来判断该文件是否是目录。trimPath函数则通过字符串截取的方式，去除一个嵌入式文件路径前的"/"字符。

总之，embedFileList函数为Go语言中的文件嵌入提供了一个便捷的接口，可以方便地获取嵌入式文件的信息，从而实现相应的功能。



### embedKind

embedKind函数是用来判断嵌入资源的类型的。在Go 1.16之后可以使用`embed`关键字将文件或目录嵌入到Go二进制文件中。嵌入的文件或目录在运行时可以通过`embed.FS`类型访问。

嵌入资源的类型可以是文件，也可以是目录。在处理嵌入类型时，需要使用embedKind函数来判断类型。embedKind函数的实现方式很简单，它根据文件名的后缀来判断类型。

如果文件名的后缀是`.syso`，则认为是Windows的资源文件。否则，根据文件的mime类型来判断是普通文件(`embedKindBytes`)还是目录(`embedKindDir`)。

当文件后缀是`.syso`时，它会将`embedKindSyso`变量设置为true，表示当前嵌入资源是Windows的资源文件。这个标志在后续处理中有用。

总之，embedKind函数的主要作用是根据文件名或mime类型来判断嵌入资源的类型，以便后续处理。



### embedFileNameSplit

embedFileNameSplit 函数的作用是将文件名拆分为目录名和文件名。此函数是用于处理 embed 包中文件路径的函数之一。

该函数接受一个字符串参数 fileName，并根据路径分隔符“/”将其拆分为两部分，目录名和文件名，并返回两个字符串。如果没有路径分隔符，则目录名为空字符串。

例如，如果传递的字符串为 "dir/file.txt"，则该函数将返回两个字符串 "dir" 和 "file.txt" 作为元组返回。如果传递的字符串是 "file.txt"，则该函数仅返回一个元组，其中第一个字符串为空字符串，第二个字符串为 "file.txt"。

该函数主要是用于处理内嵌包中的文件路径，将文件路径分解为目录和文件名，以便更方便地访问和处理内嵌文件的内容。它是 Go 1.16 版本中新增的一个函数，可以使用 go generate 自动生成产生 embed 包中的代码。



### embedFileLess

embedFileLess函数是一个用于排序嵌入式文件名称的排序器，用于在嵌入式文件的Map中对文件名称进行排序。在embedFileLess函数中，它根据两个文件名称字符串的字典顺序进行比较，以确定这两个名称的相对顺序。如果第一个字符串小于第二个字符串，则返回true，否则返回false。

该函数在实现嵌入式文件Map时，通过对文件名称进行排序，可以使Map的迭代输出结果保持一定的顺序，便于程序进行可预测的处理和调试。



### WriteEmbed

WriteEmbed函数的作用是将嵌入式文件写入到Go源码文件中。这个函数是在go命令行工具中用于嵌入文件系统的一个重要组件。

具体来说，WriteEmbed函数将一个或多个文件嵌入到Go二进制文件中，以便在运行时访问这些文件。它将生成一个Go源代码文件，该文件包含嵌入式文件的字节，文件名和文件权限。

这个函数可以让程序员在开发过程中将配置文件、静态资源文件等存储在二进制文件中，最终发布时只需要发布一个二进制程序即可，这样避免了程序依赖于外部文件的问题。同时，嵌入文件也可以增加应用程序的安全性，因为嵌入的文件难以被恶意篡改。

使用这个函数需要传递一些参数，包括存储嵌入式文件的名称，文件系统的包名称，以及嵌入文件时需要执行的函数等。这些参数的设置需要依据具体的应用场景和需求来进行设置。



