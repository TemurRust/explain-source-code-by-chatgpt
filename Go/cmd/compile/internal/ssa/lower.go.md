# File: lower.go

`lower.go`文件位于Go编译器源代码的`cmd`目录下，其作用是将高级别的Go代码转换为更低级别的代码（LLVM IR）。

在Go语言的编译过程中，首先经过前端（parser）将Go代码转换为抽象语法树（AST），然后进行类型检查和常量表达式求值等操作，最终会得到一个中间表示（IR）。而在最终的生成目标文件之前，需要将这个中间表示转化为机器码。而这个转化过程就需要通过`lower.go`来实现。

`lower.go`包含了许多针对Low-level Virtual Machine（LLVM）的转换，例如将Go语言的函数调用转换为LLVM IR的函数调用，将Go语言的指针引用转换为LLVM IR中的指针引用等。这些转换是为了最终将Go代码编译为机器码。

总之，`lower.go`是Go编译器的一个重要组成部分，负责将Go代码转换为最终的机器码。

## Functions:

### lower

在Go语言编译器中，lower函数是一个重要的优化函数。它的作用是将高级语言的语法转换成底层语言的语法。在这个过程中，lower函数将执行以下几个重要的步骤：

1. 函数展开：函数展开指的是将函数调用替换为函数体本身。这样，编译器就可以在编译的过程中执行更多的优化和简化操作。

2. 类型转换：为了使程序能够在底层语言上运行，lower函数将执行必要的类型转换。例如，将指针转换为整数表示，或将浮点数转换为整数表示。

3. 内联函数：内联函数指的是将函数调用直接替换为函数体，以消除函数调用的开销。这个过程通常会增加代码的大小，但会显著提高程序的性能。

4. 优化代码：在lower函数中，编译器会执行各种各样的优化操作，以提高程序性能并减少代码大小。

通过这样一系列的转换和优化，编译器就可以将高级语言的代码转换为底层语言的代码，并使程序在底层语言上运行的更加高效和快速。



### lateLower

在 Go 语言的编译过程中，一个重要的步骤就是将 AST（抽象语法树）转换为 SSA（静态单赋值形式）表示，这个过程就是 Lowering。

在 lower.go 文件中，lateLower 函数是 Lowering 的最后一步，相当于对 SSA 表示进行一些后处理，为后续的代码生成做准备。

具体来说，lateLower 函数的主要作用如下：

1. 为全局变量和函数声明创建 SSA 值。这样后续的代码生成器就可以通过 SSA 值来引用全局变量和函数了。

2. 为 select 语句和 defer 语句插入必要的 SSA 命令，保证它们可以正确执行。

3. 分配寄存器并生成机器码。这样程序就可以在目标机器上运行了。

总之，lateLower 函数是编译器的重要组成部分，它完成了编译过程的最后一步，将 SSA 表示转化为机器代码，让程序能够在真正的计算机上运行。



### checkLower

checkLower函数是Go编译器的中间过程之一，作用是检查对于已知的枚举（enum）或常量（const）是否存在非法的下限值（lower bound）。下限值指的是定义常量时的最小限制，如果只定义了枚举值的上限而没有定义下限，则编译器将自动设置下限为0。

在checkLower函数中，它首先通过访问类型描述信息来获取已知的枚举或常量的下限值。然后，它会检查当前的常量是否小于或等于已知下限值，如果不是，则会生成一个编译错误信息。

这个函数的目的是确保枚举或常量定义的值在有效范围内，避免意外的类型转换错误或程序运行时的不一致性。

总之，checkLower函数作为编译器的一部分，是用来检查枚举或常量定义的合法性，避免程序出现错误和不一致性。



