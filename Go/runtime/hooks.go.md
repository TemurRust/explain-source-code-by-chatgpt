# File: hooks.go

hooks.go是Go语言标准库中runtime包中的一个文件，它定义了用于扩展运行时（runtime）的钩子函数。这些钩子函数允许用户在特定的事件发生时（如线程创建、垃圾回收、程序崩溃等）作出响应，并且可以与现有的运行时功能（如调试、垃圾回收）集成。

具体来说，hooks.go文件中定义了以下钩子函数：

- StartTrace：在程序执行时开始进行跟踪。
- StopTrace：在程序执行时停止进行跟踪。
- ThreadCreateProfile：在线程创建时收集线程创建时的堆栈信息。
- SetCgoTraceback：设置调用C代码的回溯信息。
- SetPanicOnFault：设置是否在故障时触发崩溃。
- MemProfileRate：设置控制内存分配速率的变量的值。
- GCStart：在垃圾回收开始时调用的函数。
- GCDone：在垃圾回收完成时调用的函数。
- Preemptible：设置调度器是否允许抢占。

这些钩子函数可以通过在初始化时设置相应的函数指针来实现。用户可以自定义这些函数，根据自己的需要在事件发生时执行一些定制的操作。同时，由于这些钩子函数都是可选的，可以根据需要自由选择需要使用的钩子函数，不会对程序的基本功能产生影响。

总之，hooks.go文件提供了一种灵活的扩展方式，允许用户自定义运行时行为以满足特定需求。

## Functions:

### initHook

initHook这个函数是runtime系统中的钩子函数，其作用是在程序启动时运行，以实现对程序运行环境的自定义设置和检查，以及执行其他的定制化操作。

在initHook函数的内部，会依次调用各个模块的init函数，这些init函数会按照一定的顺序进行初始化工作，包括对某些全局变量进行初始化、打印启动信息等等。此外，initHook函数还会执行一些类似GC的初始化工作，以确保在程序运行过程中能够及时回收垃圾空间等。

由于initHook函数在程序启动时被调用，所以可以利用它来进行自定义初始化的设置和检查，例如检查环境变量是否正确配置，检查系统权限是否被正确设置等。同时，我们还可以根据具体的需求，开发自己的init函数并在其中完成特定的初始化工作。



### runtime_addExitHook

runtime_addExitHook是Go语言运行时的一个hook函数，它的作用是向运行时注册一个退出钩子函数，当程序退出时执行这个函数。

具体而言，这个函数会将传入的函数指针添加到运行时的hook list列表中，这个列表中保存了所有已注册的退出钩子函数。当程序即将退出时，运行时会按照注册的顺序依次执行这些钩子函数，以便进行一些清理工作或者其他的处理。

例如，在一个长时间运行的服务程序中，可能需要在程序退出前关闭一些资源或者进行一些最终的统计工作，这时就可以使用runtime_addExitHook函数注册一个退出钩子函数来实现这个功能。

值得注意的是，钩子函数执行的时间非常有限，不能做任何耗时或阻塞的操作，否则可能会造成程序异常或崩溃。因此，在编写钩子函数时应该尽量保持简单和轻量级，避免影响正常程序的流程。



