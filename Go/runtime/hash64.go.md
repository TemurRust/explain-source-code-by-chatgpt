# File: hash64.go

hash64.go 是 Go 语言的运行时库中的一个文件，其主要作用是提供哈希函数的实现，用于实现 Go 语言中的 map 和 set 数据结构。

哈希函数是一种用于将任意长度的消息压缩到固定大小的摘要（hash 值）的函数。在 Go 中，哈希函数主要用于实现 map 和 set 数据结构中的键值对。这些数据结构是非常常用的，它们的实现也是极其重要的。

hash64.go 中定义了多种哈希函数的实现，包括 FNV-1 和 FNV-1a 哈希算法、MurmurHash 等。这些哈希函数的实现都非常高效，并且具有很好的哈希性能。

此外，hash64.go 中还定义了一些与哈希函数相关的数据结构和函数，如哈希表的桶（bucket）、哈希值的初始种子、计算哈希值的方法等。这些数据结构和函数的实现也对 map 和 set 数据结构的性能和正确性起到了重要的作用。

总之，hash64.go 文件的作用非常重要，它提供了高效、稳定的哈希函数实现，支持 Go 语言中 map 和 set 数据结构的正确和高效运行。

## Functions:

### memhashFallback

hash64.go文件位于Go语言的runtime包下，其中的memhashFallback函数用于对字节数组进行Hash计算。该函数主要的作用是在不能使用硬件指令进行Hash计算时，使用非常快速的软件算法进行Hash操作，以确保计算的高效性和准确性。

具体来说，memhashFallback函数使用的是一种基于MurmurHash3算法的Hash计算方式，该算法具有高效、可靠、分散和不可预知性等特点，适合在不同的场景下进行Hash操作。该算法对于大规模的数据集合可以快速地计算Hash值，在保证数据质量和可靠性的同时，极大地提高处理速度和效率。

总的来说，memhashFallback函数的作用是在Go程序需要进行大规模的字节数组Hash计算时，提供高效、快速和准确的Hash操作。它是Go语言runtime包中非常重要的函数之一，为Go语言提供了高效的Hash计算功能。



### memhash32Fallback

memhash32Fallback是runtime包中用于进行32位哈希计算的函数。

该函数主要用途是当CPU不支持64位指令集（例如在32位系统上）时，使用32位哈希计算来取代64位哈希计算。其作用是将数据转换为32位哈希值，并且将结果分散在散列表中。该函数通常用于在哈希表中查找元素时，使用哈希算法快速定位元素所在位置。

具体来说，该函数采用了MurmurHash3算法来计算32位哈希值，该算法具有较快的哈希速度、低冲突率及较好的分散性。在计算过程中，该函数将输入的数据划分为4字节的块，并对每个块进行哈希计算，最后将哈希值进行混合以获得最终的32位哈希值。

需要注意的是，memhash32Fallback函数通常不直接被用户代码调用，而是被其他runtime函数调用（例如map的哈希函数等）。该函数主要被用于处理低端设备或低端系统上的哈希计算，具有较好的通用性和兼容性。



### memhash64Fallback

memhash64Fallback是Go语言中哈希算法的一个实现函数。当数据需要哈希的长度不足8字节时，该函数会被调用，以进行哈希处理。

具体而言，memhash64Fallback函数会使用Go语言中内置的哈希函数（hash64），对长度小于8字节的数据进行哈希。也就是说，如果数据长度大于等于8字节，Go就会使用更高效的哈希算法（比如memhash64或者memhash64_2），而不是使用memhash64Fallback。

需要注意的是，memhash64Fallback函数的实现并不是特别高效，因为它需要将数据字节拷贝到一个长度为8字节的数组中。因此，尽量避免在数据长度小于8字节时使用哈希，以提高程序的性能。

总之，memhash64Fallback函数是Go语言中哈希算法的一个辅助函数，用于处理长度小于8字节的数据的哈希操作。



### mix

mix函数被用于生成一个64位的哈希值，该哈希值用于帮助分配map中元素的索引地址。mix函数接收两个参数，即原始哈希值和一个种子值，用于对原始哈希值进行进一步混合和扰动。具体来说，mix函数将种子值与原始哈希值异或操作所得到的结果左移17位，然后用原始哈希值的高32位异或该结果，接着将结果左移31位，再次用原始哈希值的低32位异或该结果，最后将结果与一个特定的常量0xdeadbeef殷勤操作即可。这样得到的64位哈希值具有良好的随机性和分布特性，可以对map中元素进行均匀的分布和快速的查询。



### r4

r4函数是Go语言中hash64包中的一个函数，用于在64位机器上生成字符串的hash值。

具体来说，r4函数会将输入的字符串分成若干个小块，然后对每个小块进行一系列的hash计算，最终将所有计算结果合并成一个64位的hash值。r4函数采用了一种叫做“MurmurHash3”的算法，这种算法具有较高的效率和较好的分布性，可以在很短的时间内生成出高质量的hash值。

其中，r4函数的具体实现逻辑如下：

1. 设置一系列的常数，用于在hash计算过程中作为随机数的种子和掩码。

2. 将输入的字符串按照一定的规则分成若干个小块（即8字节的整数块），并对每个小块进行hash计算。

3. 将各个小块的计算结果进行合并，生成最终的64位hash值。

总的来说，r4函数可以帮助我们快速生成高质量的hash值，这对于各种数据结构和算法的实现都是非常有用的。值得一提的是，虽然r4函数在64位机器上表现最佳，但它也可以在其他平台上运行，只是生成的hash值的长度会有所不同。



### r8

r8是一个函数名，是将64位整数哈希值压缩到8位的一种实现方法，其中r8的意思是range 8，表示只压缩到8位。这个函数是用于哈希表中的键的，通过将键的哈希值压缩到较小的范围内，可以减少哈希冲突的可能性，提高哈希表的查询效率。

r8函数采用的是一种简单的哈希算法，首先将64位整数哈希值分成若干组，每组8位，然后将这些8位数进行累加，并对结果进行模运算，得到一个8位的压缩值。这个压缩值即为哈希表中键的实际哈希值。

总体来说，r8函数实现了将哈希值从64位压缩到8位的功能，通过哈希压缩减少哈希冲突，提高哈希表查询效率。



