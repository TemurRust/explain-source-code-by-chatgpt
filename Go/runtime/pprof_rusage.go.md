# File: pprof_rusage.go

pprof_rusage.go是Go语言的运行时包runtime中的一个文件，主要实现了在使用性能分析工具（如pprof）时收集进程资源使用情况的功能。

在Linux系统中，进程的资源使用情况可以通过读取/proc/self/stat文件实现。该文件包含了进程的状态信息，其中就包括一些有关进程资源使用情况的信息，如CPU时间、内存使用量、I/O统计等等。pprof_rusage.go利用了这些信息来收集进程的资源使用情况，并将其用于性能分析、调优等用途。

具体来说，pprof_rusage.go实现了两个函数：pprofCPU和pprofAllocs。pprofCPU函数用于收集进程的CPU时间使用情况，包括用户态CPU时间和内核态CPU时间。pprofAllocs函数用于收集进程的内存消耗情况，包括堆内存使用量、栈内存使用量和系统调用内存使用量等。

这些函数可以被pprof等性能分析工具调用，以获取进程的资源使用情况，并生成相应的分析报告。由于pprof_rusage.go采用了系统级别的资源使用情况统计方法，因此能够提供准确、详细的性能分析结果，方便开发者进行性能优化、问题排查等工作。

## Functions:

### addMaxRSS

addMaxRSS函数用于将当前进程的峰值虚拟内存使用量添加到pprof框架中。在UNIX系统中，峰值虚拟内存使用量通常被称为最大常驻集大小（maximum resident set size，简称maxrss），即进程使用的所有虚拟内存的峰值大小。

addMaxRSS函数的实现中，它会通过getrusage系统调用获取进程的资源使用情况，其中包括最大常驻集大小，然后将最大常驻集大小转换为字节数，最后将其添加到pprof框架中。

该函数的作用在于，通过收集进程的最大常驻集大小，可以帮助开发者识别内存泄漏和资源浪费的情况，从而提高程序的性能和可靠性。



