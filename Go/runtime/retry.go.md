# File: retry.go

retry.go文件的作用是处理并发执行时的重试机制，它定义了一个retry结构体类型和一些retry相关的函数。

在并发执行中，一些操作可能会因为竞争条件等原因失败，此时需要通过重试保证操作的完成。retry结构体就是为此而设计的，它包含了以下字段：

- f：需要重试的函数；
- s：重试的状态；
- m：重试时使用的mutex；
- cnt：重试次数；
- fn：重试的函数名；
- wait：每次重试之间的等待时间。

retry结构体提供了一些方法来控制重试的过程，例如：

- reset方法：重置记录的重试次数。
- retrying方法：返回当前是否处于重试状态。
- tailcall方法：立即调用f方法，而不是通过加锁的方式来执行。

retry.go文件还定义了一些retry相关的函数，例如：

- genericRetry函数：重试次数自增，返回重试状态和是否正在重试的标志位。
- saveStack函数：保存当前的堆栈信息。
- startLocked函数：原子地将状态设置为重试，并且保存堆栈信息，避免在多个goroutine同时重试时发生状态错误。

总之，retry.go文件的作用是为并发执行提供了一套可靠的重试机制，避免了因为竞争条件等原因导致的操作失败。

## Functions:

### retryOnEAGAIN

retryOnEAGAIN是一个函数，其作用是在执行系统调用时，如果出现EAGAIN错误（表示资源暂时不可用），则进行一定次数的重试，直到资源可用或达到重试次数上限为止。

在Go语言中，当执行系统调用（例如read、write等）时，如果出现EAGAIN错误，表示该操作可能会阻塞，等待资源可用。在这种情况下，retryOnEAGAIN函数会进行一定次数的重试，以便等待资源可用。当资源可用或达到重试次数上限时，retryOnEAGAIN函数将返回以下结果之一：

- 如果可用的字节数大于0，表示重试成功，返回可用的字节数。
- 如果不可用的字节数大于0，表示在尝试了最大次数之后仍没有可用的资源，返回不可用的字节数。
- 如果可用的字节数和不可用的字节数都为0，表示重试失败，返回EAGAIN错误。

retryOnEAGAIN函数主要用于处理系统调用的EAGAIN错误，以避免程序在等待资源可用时被阻塞，提高程序的响应速度和可靠性。



