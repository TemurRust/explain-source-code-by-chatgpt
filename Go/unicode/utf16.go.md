# File: utf16.go

utf16.go文件是Go语言标准库unicode包中的一个文件，它实现了UTF-16编码的编码、解码、转换等操作。

UTF-16是一种Unicode编码方式，它使用16位的整数来表示每个字符，包括基本多文种平面（BMP）和补充平面（SMP）中的字符。UTF-16编码是广泛使用的一种字符编码方式，尤其在Windows系统中应用广泛。

utf16.go文件定义了以下几个重要的函数：

1. EncodeRune：将Unicode字符编码为UTF-16的形式，并返回编码后的字节序列。

2. DecodeRune：将UTF-16表示的字符解码为Unicode字符，并返回解码后的值。

3. Encode：将一段UTF-16编码的字节序列转换为Unicode字符串。

4. Decode：将Unicode字符串转换为UTF-16编码的字节序列。

这些函数可以用于将UTF-16编码的字符转换为Unicode字符或者将Unicode字符转换为UTF-16编码的字符，或者进行编码和解码操作，非常便于处理UTF-16编码的数据。

总之，utf16.go文件在Go语言中实现了一系列操作UTF-16编码的函数，可以方便地进行编码、解码、转换等操作，是Go语言标准库中非常重要的一部分。

## Functions:

### IsSurrogate

IsSurrogate是一个用于Unicode字符串编码和解码的Go语言库（Unicode package）中的函数，用于检查UTF-16编码中的码位是否为代理项。代理项指的是UTF-16编码中的一组码位，用于将21位的Unicode编码映射到UTF-16的16位编码空间。由于UTF-16只能表示2^16个码位，而Unicode有2^21个码位，因此代理项被用来在UTF-16编码中表示超出基本多文本平面（BMP）的字符。

IsSurrogate函数的作用是检查给定的码位是否为UTF-16的代理项，即是否在D800-DFFF的范围内。如果是代理项，则该函数返回true；否则返回false。这个函数通常用于UTF-16编码的解码过程中，以确保解码的结果符合UTF-8编码的规范。

总之，IsSurrogate函数的作用是在UTF-16编码与Unicode之间进行转换时，判断给定的码位是否为代理项，以保证编码解码的正确性。



### DecodeRune

DecodeRune是一个函数，用于将UTF-16编码的字符转换为对应的Unicode代码点。

UTF-16是一种Unicode编码形式，使用16位数字表示每个字符。在UTF-16编码中，某些字符需要用两个16位数字来表示，这被称为“代理对”。DecodeRune函数在遇到代理对时，会将两个16位数字合并为一个代码点。

该函数的定义如下：

```go
func DecodeRune(s []uint16) (r rune, size int)
```

其中，参数s是一个UTF-16编码的字符序列，返回值r是对应的Unicode代码点，size是该代码点占用的字节数。

如果输入的字符序列不是合法的UTF-16编码，或者存在无效的代理对，DecodeRune函数会返回特殊的错误码U+FFFD，表示无法正确解析该字符。

DecodeRune函数在处理UTF-16编码的文本时非常有用，特别是在编写国际化和本地化应用时。它可以帮助开发人员正确地转换不同编码之间的文本，确保应用程序能够正确处理各种语言和字符集。



### EncodeRune

在 Go 语言中，Unicode 码点是以 int 类型表示的，但有些环境需要将 Unicode 码点表示成 16 位整数（如 Windows 系统的 wchar_t 和 Java 虚拟机的 char 类型）。这时就需要将 int 类型的 Unicode 码点转换成 16 位整数，这个过程就叫做 UTF-16 编码。

EncodeRune 这个函数的作用就是将给定的 Unicode 码点（rune 类型）编码为 UTF-16 折叠点对，并将其写入到指定的目标切片中。也就是说，EncodeRune 函数将一个 Unicode 码点转换为 UTF-16 编码，并将其写入到一个 []uint16（即 UTF-16 编码的折叠点对）类型的目标切片中。

具体实现中，EncodeRune 函数先判断给定的 Unicode 码点（rune 类型）是 BMP（Basic Multilingual Plane）范围内的字符还是超出 BMP 范围的字符。BMP 范围内的字符其实就是 0 到 0xFFFF（即 \u0000 到 \uFFFF）之间的字符。

如果是 BMP 范围内的字符，就直接写入一个 uint16 类型的值即可，因为这个值的高 8 位都是 0，所以只需要保留它的低 8 位即可。

如果是超出 BMP 范围的字符（即需要使用两个 uint16 类型的值来编码），则需要使用 surrogate pair 技术来进行编码。具体来说，超出 BMP 范围的字符的 Unicode 码点需要减去 0x10000，然后将剩余的 20 位二进制数据分别放入两个 uint16 类型的值中，第一个值的高 4 位为 1101（即 0xD），第二个值的高 4 位为 1110（即 0xE），这样就得到了两个折叠点对。最后，将这两个折叠点对依次写入到目标切片中即可。

总的来说，EncodeRune 函数就是将一个 Unicode 码点（rune 类型）转换成一个或两个 uint16 类型的值，这样就可以在某些环境中表示 Unicode 码点了。



### Encode

utf16.Encode()函数是一个将rune切片编码为UTF-16序列的函数。

具体来说，它将一组Unicode码点（也就是rune）编码为UTF-16编码序列，并返回编码序列的字节切片。UTF-16是Unicode编码的一种形式，其使用16位码元表示字符，因此要将rune（Go中表示Unicode码点的整数类型）编码为UTF-16，我们需要将它们转换为16位的字节序列。

这个函数将每个rune转换为一对16位码元，其中高位于前，低位于后，将这些码元组成一个UTF-16编码序列。如果输入rune中包含代理对（这是指一个字符需要由两个rune表示，因为Unicode字符编号无法用单个16位码元表示），那么函数将将它们分别编码为一对代理对码元。

在实际使用中，例如将rune切片存入文件或网络中时，需要使用utf16.Encode()将其编码为UTF-16序列。而在读取到字节序列后，需要使用utf16.Decode()函数进行解码，将其转换回rune切片。



### AppendRune

AppendRune函数是unicode/utf16包中的一个函数，它的作用是将单个unicode字符转换为UTF-16编码，并追加到一个UTF-16编码序列的尾部，返回更新后的序列。UTF-16编码是Unicode字符的一种编码方式，采用16位编码表示一个字符。

该函数接收两个参数：一个uint16类型的切片，表示要更新的UTF-16编码序列；一个rune类型的字符，表示要追加到序列的字符。

例如，如果我们想将字符'a'（Unicode码点为97）追加到一个UTF-16编码序列中，我们可以使用如下代码：

```
var s []uint16
s = utf16.AppendRune(s, 'a')
```

运行后，s即为一个包含字符'a'的UTF-16编码序列。

该函数的实现原理是先判断rune的值是否超过了0xFFFF（即是否需要使用2个uint16表示一个字符），如果超过，则将该字符分为高位和低位，分别转换为对应的两个uint16，并依次追加到切片中；否则直接将该字符转换为一个uint16，并追加到切片中。

总之，该函数提供了一种方便的方式将单个字符转换为UTF-16编码，并追加到一个UTF-16编码序列的尾部。



### Decode

Decode函数是一个解码UTF-16编码的函数。它将一个UTF-16编码的文本流转换为一个Unicode字符流。该函数接受一个参数s，该参数是一个包含UTF-16字符的切片。函数返回一个UTF-8编码的字符串，其中包含Unicode字符。

Decode函数的实现过程如下：

1.首先，该函数会检查输入字符串的长度，确保它包含偶数个字节，以便可以将其分割成UTF-16编码的字节对。

2.之后，该函数会创建一个包含len(s)/2个rune Unicode字符的切片。

3.然后，它会使用一个循环遍历UTF-16编码的字节对。对于每个字节对，它会将其合并为一个UTF-16编码的Code Point。

4.接下来，是一个判断，如果Code Point小于0x10000，则它是一个基础多语言平面（Basic Multilingual Plane）中的字符，直接将其写入输出流。

5.如果Code Point的值大于等于0x10000，则它是一个辅助平面（Supplementary Planes）中的字符。UTF-16编码采用了Surrogate pairs的方式表示这些字符，因此Decode函数需要处理这种情况。函数会将这个字符转换为对应的Unicode字符，然后写入输出流。

6.最后，该函数会返回UTF-8字符串，其中包含Unicode字符。

该函数的主要作用是将一个UTF-16编码的文本流转换为一个Unicode字符流并返回一个UTF-8编码的字符串。它通常用于处理从外部系统或文件中读取的UTF-16编码的数据，并将其转换为Unicode字符，以便应用程序可以使用它们。在Go语言中，UTF-16编码被广泛用于Windows系统和一些应用程序中，并且Decode函数提供了一种用于处理这些编码的方法。



### decode

decode是一个函数，它的作用是将一组UTF-16编码的字节序列转换为对应的Unicode码点序列。

具体来说，当我们使用UTF-16编码时，一个Unicode码点可能需要用1个或2个UTF-16编码单元来表示。因此，为了得到正确的Unicode码点序列，我们需要解析UTF-16编码单元序列，并根据编码规则计算出对应的Unicode码点。而这就是decode函数的主要功能。

该函数接受一个UTF-16编码的字节切片b作为参数，并返回一个Unicode码点序列的切片。具体实现过程如下：

1. 判断字节切片的长度是否为偶数，如果不是，返回错误。

2. 初始化一个Unicode码点序列的切片s。

3. 遍历字节切片b，每次取出两个字节，判断它们是否是UTF-16编码单元中的高位和低位。如果是，将它们合并为一个UTF-16编码单元u，并根据u的值计算出对应的Unicode码点p，将p加入到Unicode码点序列s中。如果不是，返回错误。

4. 返回Unicode码点序列s和nil。

总之，decode函数的作用是将一组UTF-16编码的字节序列转换为对应的Unicode码点序列。通过这个函数，我们可以方便地处理UTF-16编码的文本数据。



