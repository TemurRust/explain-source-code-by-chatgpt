# File: eth/gasprice/feehistory.go

在`go-ethereum`项目中的`eth/gasprice/feehistory.go`文件是实现以太坊的交易费用历史记录功能。以下是对该文件中各个部分的详细介绍：

1. 变量：
   - `errInvalidPercentile`：表示无效的百分位数。
   - `errRequestBeyondHead`：表示请求超出当前最新的区块高度。
  
2. 结构体：
   - `blockFees`：用于存储区块的交易费用信息，包括gas费用、矿工奖励等。
   - `cacheKey`：区块高度的缓存键，用于在缓存中存储和获取数据。
   - `processedFees`：用于存储已处理的区块交易费用信息，包括所有区块范围的费用统计。
   - `txGasAndReward`：用于存储某个区块中交易的gas使用量和矿工奖励。

3. 函数：
   - `processBlock`：处理给定区块的交易费用信息，包括收集、解析和计算等。
   - `resolveBlockRange`：根据给定的开始和结束区块高度，确定需要处理的区块范围。
   - `FeeHistory`：以太坊交易费用历史记录的主要函数，负责处理区块范围、缓存、历史记录等。

稍微详细解释一下各个部分的作用：

- `errInvalidPercentile`：当尝试使用无效的百分位时，返回此错误。
- `errRequestBeyondHead`：当请求查询的区块高度超过当前最新区块高度时，返回此错误。

结构体：

- `blockFees`：用于存储区块的交易费用信息，包括gas费用、矿工奖励等。这个结构体被用于处理区块范围内的交易，并进行相关的统计和计算。
- `cacheKey`：表示一个区块高度的缓存键，可用于将区块高度与已处理的费用信息进行关联。
- `processedFees`：用于存储已处理的区块交易费用信息，包括所有区块范围的费用统计。这个结构体中包括了区块范围所涉及的所有交易费用信息比如最大、最小、平均费用等。
- `txGasAndReward`：用于存储某个区块中交易的gas使用量和矿工奖励。这个结构体中包含了一个区块中的所有交易的gas使用量和矿工奖励（奖励用于计算最小费用）。

函数：

- `processBlock`：用于处理给定区块的交易费用信息。它会对区块内的每笔交易进行处理，统计平均费用、最小费用等。
- `resolveBlockRange`：根据给定的开始和结束区块高度，确定需要处理的区块范围。它会返回有效的区块高度范围，供后续处理使用。
- `FeeHistory`：是以太坊交易费用历史记录的主要函数，负责处理区块范围、缓存、历史记录等。它会根据传入的请求参数，调用其他函数进行区块范围的处理和记录的生成。同时，它还会根据缓存和历史记录等信息，为用户的请求提供相应的输出。

